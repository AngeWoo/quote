<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çœŸå¦‚24æ‹”è‹¦ä»£å—éˆè¨“</title>
    <style>
        /* åŸæœ‰ CSS ä¿æŒä¸è®Š */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft JhengHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            padding: 1rem;
            position: relative;
            overflow-x: hidden;
        }
        /* ... å…¶é¤˜æ¨£å¼çœç•¥ï¼Œä¿æŒåŸæ¨£ ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ¨ çœŸå¦‚24æ‹”è‹¦ä»£å—éˆè¨“ âœ¨</h1>
        <div class="quote-display" id="quoteDisplay">
            <div class="loading" id="loadingIndicator">
                <div class="loading-spinner"></div>
                <span>æ­£åœ¨è¼‰å…¥æ™ºæ…§æ³•èª...</span>
            </div>
            <div class="quote-text" id="quoteText" style="display: none;">
                é»æ“Šã€Œéš¨æ©Ÿåå¥ã€é–‹å§‹æ‚¨çš„æ™ºæ…§ä¹‹æ—…
            </div>
            <span class="quote-number" id="quoteNumber" style="display: none;"></span>
            <div class="error-message" id="errorMessage" style="display: none;"></div>
        </div>
        <div class="controls">
            <button class="btn btn-random" id="randomBtn" onclick="getRandomQuote()" disabled>
                <span class="btn-text">ğŸ² éš¨æ©Ÿåå¥</span>
            </button>
            <div class="nav-controls">
                <button class="btn" id="prevBtn" onclick="getPrevQuote()" disabled>
                    <span class="btn-text">â¬…ï¸ ä¸Šä¸€å¥</span>
                </button>
                <button class="btn" id="nextBtn" onclick="getNextQuote()" disabled>
                    <span class="btn-text">â¡ï¸ ä¸‹ä¸€å¥</span>
                </button>
            </div>
        </div>

    <script>
        // ä½¿ç”¨ Google Sheets å…¬é–‹ HTMLï¼Œé€é AllOrigins ä»£ç†ä»¥è§£æ±º CORS
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTQp08ZcC5kK1DRs8jE0FYXwmFLh5wXTxJZgdjuOK8s_UIcovZaqKqJhRIAa-Qz3yh5O80cs55euiKp/pubhtml';
        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(sheetUrl)}`;

        let quotes = [];
        let currentIndex = 0;

        // UI å…ƒç´ 
        const elements = {
            quoteText: document.getElementById('quoteText'),
            quoteNumber: document.getElementById('quoteNumber'),
            quoteDisplay: document.getElementById('quoteDisplay'),
            loadingIndicator: document.getElementById('loadingIndicator'),
            errorMessage: document.getElementById('errorMessage'),
            randomBtn: document.getElementById('randomBtn'),
            nextBtn: document.getElementById('nextBtn'),
            prevBtn: document.getElementById('prevBtn')
        };

        // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
        function initializeApp() {
            // éš±è—è¼‰å…¥ç•«é¢ä¸¦é¡¯ç¤ºå…§å®¹åŠæŒ‰éˆ•
            elements.loadingIndicator.style.display = 'none';
            elements.quoteText.style.display = 'block';
            elements.quoteNumber.style.display = 'inline-block';
            elements.randomBtn.disabled = false;
            elements.nextBtn.disabled = false;
            elements.prevBtn.disabled = false;
            displayQuote(0);
            console.log(`å·²è¼‰å…¥ ${quotes.length} å¥çœŸå¦‚åè¨€`);
        }

        // é¡¯ç¤ºåå¥
        function displayQuote(index) {
            if (quotes.length === 0) return;
            elements.quoteDisplay.classList.remove('fade-in');
            elements.quoteDisplay.style.opacity = '0.7';
            elements.quoteDisplay.style.transform = 'scale(0.98)';
            setTimeout(() => {
                elements.quoteText.textContent = quotes[index];
                elements.quoteNumber.textContent = `ç¬¬ ${index + 1} å¥ / å…± ${quotes.length} å¥`;
                elements.quoteDisplay.classList.add('fade-in');
                elements.quoteDisplay.style.opacity = '1';
                elements.quoteDisplay.style.transform = 'scale(1)';
            }, 150);
            currentIndex = index;
        }

        // éš¨æ©Ÿã€ä¸‹ä¸€å¥ã€ä¸Šä¸€å¥ å‡½å¼
        function getRandomQuote() {
            if (quotes.length === 0) return;
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * quotes.length);
            } while (randomIndex === currentIndex && quotes.length > 1);
            displayQuote(randomIndex);
        }
        function getNextQuote() {
            if (quotes.length === 0) return;
            displayQuote((currentIndex + 1) % quotes.length);
        }
        function getPrevQuote() {
            if (quotes.length === 0) return;
            displayQuote(currentIndex === 0 ? quotes.length - 1 : currentIndex - 1);
        }

        // éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', e => {
            if (['ArrowRight',' '].includes(e.key)) { e.preventDefault(); getNextQuote(); }
            else if (e.key === 'ArrowLeft') { e.preventDefault(); getPrevQuote(); }
            else if (['r','R'].includes(e.key)) { e.preventDefault(); getRandomQuote(); }
        });

        // è§¸æ§æ»‘å‹•æ”¯æŒ
        let startX = 0, startY = 0;
        elements.quoteDisplay.addEventListener('touchstart', e => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });
        elements.quoteDisplay.addEventListener('touchend', e => {
            const endX = e.changedTouches[0].clientX;
            const endY = e.changedTouches[0].clientY;
            const diffX = startX - endX;
            const diffY = startY - endY;
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                diffX > 0 ? getNextQuote() : getPrevQuote();
            }
            startX = 0; startY = 0;
        });

        // å¾ Google Sheets è¼‰å…¥åå¥
        async function fetchQuotes() {
            elements.loadingIndicator.style.display = 'flex';
            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error(`ç¶²è·¯éŒ¯èª¤ (ç‹€æ…‹ç¢¼: ${response.status})`);
                const htmlText = await response.text();
                const doc = new DOMParser().parseFromString(htmlText, 'text/html');
                const rows = doc.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const cell = row.querySelector('td:nth-child(2)');
                    if (cell) quotes.push(cell.textContent.trim());
                });
                if (quotes.length === 0) throw new Error('æœªå¾ Google Sheets è®€å–åˆ°ä»»ä½•åå¥');
                initializeApp();
            } catch (error) {
                elements.loadingIndicator.style.display = 'none';
                elements.errorMessage.style.display = 'block';
                elements.errorMessage.textContent = `è®€å–è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`;
            }
        }

        window.onload = fetchQuotes;
    </script>
</body>
</html>
